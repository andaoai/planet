<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>天体图文 - 中国天文可视化应用</title>
  <script src="js/lib/lunar.js"></script>
  <script src="js/lib/vue3.js"></script>
  <script src="js/lib/astronomy.browser.js?ver=2.4"></script>
  <link rel="stylesheet" href="css/styles.css">
  <style>
    /* 响应式布局样式 */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: "Microsoft YaHei", "微软雅黑", Arial, sans-serif;
      background-color: #1a1a1a;
      color: #e0e0e0;
      line-height: 1.6;
    }

    .app-container {
      display: flex;
      min-height: 100vh;
      background-color: #1a1a1a;
    }

    /* 左侧控制面板 */
    .control-panel {
      width: 320px;
      background-color: #242424;
      border-right: 1px solid #404040;
      overflow-y: auto;
      box-shadow: 2px 0 5px rgba(0,0,0,0.3);
    }

    .control-panel-header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px;
      text-align: center;
      position: sticky;
      top: 0;
      z-index: 10;
    }

    .control-panel-header h1 {
      font-size: 1.5rem;
      margin-bottom: 5px;
    }

    .control-panel-header p {
      font-size: 0.9rem;
      opacity: 0.9;
    }

    .control-section {
      padding: 20px;
      border-bottom: 1px solid #404040;
    }

    .control-section:last-child {
      border-bottom: none;
    }

    .control-section h3 {
      color: #e0e0e0;
      margin-bottom: 15px;
      font-size: 1.1rem;
      display: flex;
      align-items: center;
    }

    .control-section h3::before {
      content: "🌟";
      margin-right: 8px;
    }

    /* 主要内容区域 */
    .main-content {
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    .canvas-container {
      flex: 1;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
      background-color: #0d0d0d;
      min-height: 500px; /* 设置最小高度 */
      position: relative;
    }

    #my {
      border: 2px solid #404040;
      border-radius: 8px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.4);
      background-color: #000000;
      max-width: 100%;
      max-height: 100%;
      width: auto;
      height: auto;
    }

    /* 表单控件样式 */
    .checkbox-group {
      display: grid;
      gap: 8px;
    }

    .checkbox-item {
      display: flex;
      align-items: center;
      padding: 6px 0;
      transition: background-color 0.2s;
      border-radius: 4px;
    }

    .checkbox-item:hover {
      background-color: #333333;
    }

    .checkbox-item input[type="checkbox"] {
      margin-right: 8px;
      transform: scale(1.1);
    }

    .checkbox-item label {
      cursor: pointer;
      font-size: 0.9rem;
      line-height: 1.4;
      color: #e0e0e0;
    }

    /* 按钮样式 */
    .button-group {
      display: flex;
      gap: 8px;
      margin-top: 15px;
      flex-wrap: wrap;
    }

    .btn {
      padding: 8px 16px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.9rem;
      transition: all 0.2s;
      flex: 1;
      min-width: 80px;
    }

    .btn-primary {
      background-color: #007bff;
      color: white;
    }

    .btn-primary:hover {
      background-color: #0056b3;
    }

    .btn-secondary {
      background-color: #6c757d;
      color: white;
    }

    .btn-secondary:hover {
      background-color: #545b62;
    }

    /* 输入框样式 */
    .form-group {
      margin-bottom: 15px;
    }

    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: 500;
      color: #b0b0b0;
    }

    .form-group input, .form-group select {
      width: 100%;
      padding: 8px 12px;
      border: 1px solid #555555;
      border-radius: 4px;
      font-size: 0.9rem;
      background-color: #333333;
      color: #e0e0e0;
    }

    .form-group input:focus, .form-group select:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.25);
    }

    /* 位置输入组 */
    .location-inputs {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }

    /* 时间输入组 */
    .time-inputs {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }

    .time-inputs input {
      width: 60px;
      padding: 6px 8px;
      border: 1px solid #555555;
      border-radius: 4px;
      text-align: center;
      background-color: #333333;
      color: #e0e0e0;
    }

    .time-span-input {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    /* 快捷键说明 */
    .keyboard-shortcuts {
      background-color: #2d2d2d;
      border-radius: 4px;
      padding: 15px;
    }

    .keyboard-shortcuts h4 {
      color: #ff6b6b;
      margin-bottom: 10px;
      font-size: 1rem;
    }

    .keyboard-shortcuts ol {
      padding-left: 20px;
    }

    .keyboard-shortcuts li {
      margin-bottom: 8px;
      font-size: 0.85rem;
      line-height: 1.4;
      color: #e0e0e0;
    }

    /* 底部导航栏 */
    .bottom-nav {
      background-color: #242424;
      border-top: 1px solid #404040;
      padding: 15px 20px;
      box-shadow: 0 -2px 10px rgba(0,0,0,0.3);
    }

    .nav-buttons {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      justify-content: center;
    }

    .nav-btn {
      padding: 10px 16px;
      border: 1px solid #555555;
      background-color: #333333;
      color: #e0e0e0;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.85rem;
      transition: all 0.2s;
      min-width: 80px;
    }

    .nav-btn:hover {
      background-color: #667eea;
      color: white;
      border-color: #667eea;
    }

    /* 折叠面板 */
    .collapsible {
      cursor: pointer;
    }

    .collapsible-content {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease-out;
    }

    .collapsible.active .collapsible-content {
      max-height: 1000px;
    }

    .collapsible.active h3::before {
      content: "📂";
    }

    /* 响应式设计 */
    @media (max-width: 768px) {
      .app-container {
        flex-direction: column;
      }

      .control-panel {
        width: 100%;
        order: 2;
        max-height: 40vh;
      }

      .main-content {
        order: 1;
      }

      .canvas-container {
        min-height: 50vh;
      }

      .button-group {
        flex-direction: column;
      }

      .btn {
        width: 100%;
      }
    }

    /* 滚动条样式 */
    .control-panel::-webkit-scrollbar {
      width: 6px;
    }

    .control-panel::-webkit-scrollbar-track {
      background: #2d2d2d;
    }

    .control-panel::-webkit-scrollbar-thumb {
      background: #555555;
      border-radius: 3px;
    }

    .control-panel::-webkit-scrollbar-thumb:hover {
      background: #6a6a6a;
    }
  </style>
</head>

<body>
  <div id="app" class="app-container">
    <!-- 左侧控制面板 -->
    <aside class="control-panel">
      <div class="control-panel-header">
        <h1>天体图文</h1>
        <p>中国天文可视化应用</p>
      </div>

      <!-- 基础显示设置 -->
      <div class="control-section">
        <h3>基础显示</h3>
        <div class="checkbox-group">
          <div class="checkbox-item">
            <input type="checkbox" id="guijiMode" v-model="settings.s.guijiMode">
            <label for="guijiMode">轨迹模式 (O)</label>
          </div>
          <div class="checkbox-item">
            <input type="checkbox" id="faceMode" v-model="settings.s.faceMode">
            <label for="faceMode">俯视图/侧视图 (I)</label>
          </div>
          <div class="checkbox-item">
            <input type="checkbox" id="showPlanetDistance" v-model="settings.s.showPlanetDistance">
            <label for="showPlanetDistance">展示行星距离 (T)</label>
          </div>
          <div class="checkbox-item">
            <input type="checkbox" id="showPlanetData" v-model="settings.s.showPlanetData">
            <label for="showPlanetData">显示行星数据 (P)</label>
          </div>
        </div>
      </div>

      <!-- 历法显示 -->
      <div class="control-section collapsible" :class="{ active: showCalendarSection }" @click="showCalendarSection = !showCalendarSection">
        <h3>历法显示</h3>
        <div class="collapsible-content">
          <div class="checkbox-group">
            <div class="checkbox-item">
              <input type="checkbox" id="show24Jieqi" v-model="settings.s.show24Jieqi">
              <label for="show24Jieqi">显示24节气圈</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="show24JieqiClockwise" v-model="settings.s.show24JieqiClockwise">
              <label for="show24JieqiClockwise">24节气顺时针 (L)</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="show28Xiu" v-model="settings.s.show28Xiu">
              <label for="show28Xiu">显示28宿</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="showDouJian" v-model="settings.s.showDouJian">
              <label for="showDouJian">显示12月历年建</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="showYueJian" v-model="settings.s.showYueJian">
              <label for="showYueJian">显示12月历月建</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="show10Yueli" v-model="settings.s.show10Yueli">
              <label for="show10Yueli">显示10月历</label>
            </div>
          </div>
        </div>
      </div>

      <!-- 高级设置 -->
      <div class="control-section collapsible" :class="{ active: showAdvancedSection }" @click="showAdvancedSection = !showAdvancedSection">
        <h3>高级设置</h3>
        <div class="collapsible-content">
          <div class="checkbox-group">
            <div class="checkbox-item">
              <input type="checkbox" id="useEcliptic" v-model="settings.s.useEcliptic">
              <label for="useEcliptic">黄道面/赤道面 (Q)</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="southUp" v-model="settings.s.southUp">
              <label for="southUp">正南方向朝上 (Y)</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="BeiDouFaceSouth" v-model="settings.s.BeiDouFaceSouth">
              <label for="BeiDouFaceSouth">北斗面南观测 (W)</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="showLine" v-model="settings.s.showLine">
              <label for="showLine">行星连线 (B)</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="showSunPlanetTrack" v-model="settings.s.showSunPlanetTrack">
              <label for="showSunPlanetTrack">行星轨道 (U)</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="onlyShow7Yao" v-model="settings.s.onlyShow7Yao">
              <label for="onlyShow7Yao">只显示七曜</label>
            </div>
          </div>
        </div>
      </div>

      <!-- 观测位置 -->
      <div class="control-section">
        <h3>观测位置</h3>
        <div class="location-inputs">
          <div class="form-group">
            <label>经度</label>
            <input type="number" v-model.number="position.s.longitude" step="0.0001">
          </div>
          <div class="form-group">
            <label>纬度</label>
            <input type="number" v-model.number="position.s.latitude" step="0.0001">
          </div>
          <div class="form-group" style="grid-column: 1 / -1;">
            <label>海拔 (米)</label>
            <input type="number" v-model.number="position.s.altitude">
          </div>
        </div>
        <div class="button-group">
          <button class="btn btn-primary" @click="savePosition()">保存位置</button>
          <button class="btn btn-secondary" @click="resetCanvas();paint()">刷新显示</button>
        </div>
      </div>

      <!-- 时间设置 -->
      <div class="control-section">
        <h3>时间设置</h3>
        <div class="form-group">
          <label>日期时间</label>
          <div class="time-inputs">
            <input type="number" :value="today.s.year" @input="nowProcess('year', $event.target.value)" placeholder="年">
            <span>年</span>
            <input type="number" :value="today.s.month" @input="nowProcess('month', $event.target.value)" placeholder="月">
            <span>月</span>
            <input type="number" :value="today.s.day" @input="nowProcess('day', $event.target.value)" placeholder="日">
            <span>日</span>
            <input type="number" :value="today.s.hour" @input="nowProcess('hour', $event.target.value)" placeholder="时">
            <span>时</span>
            <input type="number" :value="today.s.minute" @input="nowProcess('minute', $event.target.value)" placeholder="分">
            <span>分</span>
            <input type="number" :value="today.s.seconds" @input="nowProcess('seconds', $event.target.value)" placeholder="秒">
            <span>秒</span>
          </div>
        </div>
        <div class="form-group">
          <label>快捷时间跨度 (E/R)</label>
          <div class="time-span-input">
            <input type="number" v-model="timeSpan" size="3" style="width: 80px;">
            <select v-model="timeUnit" style="width: 60px;">
              <option v-for="r in '年月日'" :value="r">{{r}}</option>
            </select>
          </div>
        </div>
      </div>

      <!-- 快捷键说明 -->
      <div class="control-section collapsible" :class="{ active: showShortcutsSection }" @click="showShortcutsSection = !showShortcutsSection">
        <h3>快捷键说明</h3>
        <div class="collapsible-content">
          <div class="keyboard-shortcuts">
            <h4>⚠️ 重要提示：按Y固定正南方向朝上</h4>
            <ol>
              <li><strong>J/K</strong> - 前后一天，按住K播放动画</li>
              <li><strong>N/M</strong> - 前后一小时</li>
              <li><strong>D/F</strong> - 前后一分钟</li>
              <li><strong>I</strong> - 切换侧视图</li>
              <li><strong>O</strong> - 切换轨迹模式</li>
              <li><strong>A</strong> - 跳到历元：1962年2月5日</li>
              <li><strong>Z/X/C</strong> - 跳到6点/0点/18点</li>
              <li><strong>Shift+X</strong> - 跳到12点</li>
              <li><strong>W</strong> - 切换北斗观测视角</li>
              <li><strong>E/R</strong> - 70年为单位跳转</li>
              <li><strong>G</strong> - 28宿360/365.25度制</li>
            </ol>
          </div>
        </div>
      </div>
    </aside>

    <!-- 主要内容区域 -->
    <main class="main-content">
      <!-- 画布容器 -->
      <div class="canvas-container">
        <canvas id="my"></canvas>
      </div>

      <!-- 底部导航栏 -->
      <nav class="bottom-nav">
        <div class="nav-buttons">
          <button class="nav-btn" @click="nextday(-1)">前一天 (J)</button>
          <button class="nav-btn" @click="nextday(1)">后一天 (K)</button>
          <button class="nav-btn" @click="nextHour(-1)">前1小时 (N)</button>
          <button class="nav-btn" @click="nextHour(1)">后1小时 (M)</button>
          <button class="nav-btn" @click="nextMinute(-1)">前1分钟 (D)</button>
          <button class="nav-btn" @click="nextMinute(1)">后1分钟 (F)</button>
          <button class="nav-btn" @click="now.value = new Date(); intIdx = makeInterval(); paint();">今天 (H)</button>
        </div>
      </nav>
    </main>
  </div>
  <script src="js/config.js"></script>
  <script src="js/app.js"></script>
</body>

</html>